#!/usr/bin/env node

const fs = require("fs");
const readme_model0 = require("../models/model0");
const readme_model1 = require("../models/model1");

// taking the parameters that come from the command in the terminal
const all_params = process.argv;

if (all_params.length == 4) {
  if (all_params[2] == "-y") {
    // leaving only parameter "-y"
    var param_accept = all_params.slice(2);
    param_accept.pop();

    // leaving only the readme model
    var readme_model = all_params.slice(3);

    if (readme_model == "0") {
      var content_file = readme_model0;
    }
    if (readme_model == "1") {
      var content_file = readme_model1;
    }
  }
}

if (all_params.length == 3) {
  if (all_params[2] == "-y") {
    // leaving only parameter "-y"
    param_accept = all_params[2];
    var content_file = readme_model0;
  }
  if (all_params[2] == "0") {
    var content_file = readme_model0;
  }
  if (all_params[2] == "1") {
    var content_file = readme_model1;
  }
}

// If nothing comes up with the readme-cli-create command
if (all_params.length == 2) {
  var content_file = readme_model0;
}

// seeing which directory path we are running command
const my_path = process.cwd();

// seeing which files exist in the directory
const files_in_dir = fs.readdirSync(my_path);

// checking if "-y" parameter came in the command
if (param_accept == "-y") {
  create_file(content_file);
} else {
  verify_content(files_in_dir);
}

// checking if a readme file already exists in the directory
function verify_content(files_in_dir) {
  const readme_exists = files_in_dir.includes("README.md");
  exists_readme(readme_exists);
}

// return if there is already a readme or not
function exists_readme(readme_exists) {
  if (readme_exists == true) {
    console.log("ðŸ”§ Generating file\n");
    setTimeout(() => { console.log(`ðŸš« There is already a README.md file in your directory ${my_path}`); }, 1000);
    setTimeout(() => { console.log("ðŸ¤· If you want to replace this existing README.md with another one there are some alternatives, delete it, rename it or use -y parameter in CLI command execution. Ex: readme-cli-create -y"); }, 1000);
    return;
  } else {
    create_file(content_file);
  }
}

// function that creates the readme file
function create_file(content_file) {
  console.log("ðŸ”§ Generating file\n");
  setTimeout(() => { 
    fs.writeFile("README.md", content_file, (err) => {
      if (err) throw err;
    });
    console.log(`âœ… The file has been created in path ${my_path}`); 
  }, 1000);
}
